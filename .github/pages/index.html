<!-- Created 2023-03-01 -->
<!DOCTYPE html>
<html lang="en">

<head>
    <title>Configurable Systems</title>
    <link rel="icon" type="image/x-icon" href="https://www.se.cs.uni-saarland.de/images/se-icon.png">
    <link href="index.css" rel="stylesheet" type="text/css">
    <script type="text/javascript">
        const search = new URLSearchParams(window.location.search);
        const domain = search.has('domain') ? search.get('domain') : 'https://se-sic.github.io/ConfigurableSystems';

        function render() {
            fetch(`${domain}/index.json`)
                .then(response => response.json())
                .then(index => render_index(index))
                .catch(console.error);
        }
    </script>
</head>

<body>
<div id="content">
    <div id="index">
        <form>
            <label for="filter">
            </label>
            <input id="filter" type="text" class="input" placeholder="filter..."/>
            <script>
                document.getElementById('filter').addEventListener('input', (event) => {
                    const input = event.target.value.trim().toLowerCase();
                    document.getElementById('table').querySelectorAll('.item').forEach(item => {
                        const data = item.querySelector('.data.name');
                        if (!input || data.textContent.toLowerCase().includes(input)) {
                            item.className = 'item default';
                            data.innerHTML = data.textContent.replace(new RegExp(input, 'gi'), (match) => {
                                return `<mark>${match}</mark>`;
                            });
                        } else {
                            item.className = 'item hidden';
                            data.innerHTML = data.textContent;
                        }
                    });
                });
            </script>
            <button id="clear" type="button">
                x
            </button>
            <script>
                document.getElementById('clear').addEventListener('click', (_) => {
                    document.getElementById('filter').value = '';
                    document.getElementById('table').querySelectorAll('.item').forEach(item => {
                        item.className = 'item default';
                        const data = item.querySelector('.data.name');
                        data.innerHTML = data.textContent;
                    });
                });
            </script>
        </form>
        <table>
            <colgroup>
                <col style="width:25%">
                <col style="width:15%">
                <col style="width:35%">
                <col style="width:20%">
                <col style="width:5%">
            </colgroup>
            <thead>
            <tr>
                <th>Name</th>
                <th>Metadata</th>
                <th>Preview</th>
                <th>Files</th>
                <th>Links</th>
            </tr>
            </thead>
            <tbody id="table">
            </tbody>
        </table>
        <script type="text/javascript">
            function render_index(index) {
                Object.values(index).forEach(feature_model => {
                    const tr = document.createElement('tr');
                    tr.className = 'item default';
                    {
                        const td = document.createElement('td');
                        td.innerHTML = `
                            <div class="data name">
                                ${feature_model['name']}
                            </div>`;
                        tr.append(td);
                    }
                    {
                        const td = document.createElement('td');
                        td.innerHTML = `
                            <div class="data metadata">
                                <span>Features: ${feature_model['metadata']['features']}</span>
                                <span>Constraints: ${feature_model['metadata']['constraints']}</span>
                                <span>Depth: ${feature_model['metadata']['depth']}</span>
                            </div>`;
                        tr.append(td);
                    }
                    {
                        const td = document.createElement('td');
                        const preview = document.createElement('img');
                        preview.className = 'preview';
                        preview.alt = feature_model['name'];
                        preview.title = feature_model['name'];
                        preview.src = `${domain}/${feature_model['preview']['thumbnail']}`;
                        td.innerHTML = `
                            <a href="${domain}/${feature_model['preview']['source']}" target="_blank" rel="noopener noreferrer">
                                ${preview.outerHTML}
                            </a>`;
                        tr.append(td);
                    }
                    {
                        const links = document.createElement('div');
                        links.className = 'links';
                        feature_model['files'].forEach(file => {
                            const link = document.createElement('div');
                            link.className = 'link';
                            link.innerHTML = `
                                <a href="${domain}/${file['source']}" target="_blank" rel="noopener noreferrer">
                                    ${file['format']}
                                </a>`;
                            links.append(link);
                        });
                        const td = document.createElement('td');
                        td.appendChild(links);
                        tr.append(td);
                    }
                    {
                        const td = document.createElement('td');
                        const github = document.createElement('img');
                        github.className = 'github';
                        github.alt = 'github';
                        github.title = 'Edit on GitHub';
                        github.src = 'https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png';
                        td.innerHTML = `
                            <a href="https://github.com/se-sic/ConfigurableSystems/edit/master/${feature_model['name']}/FeatureModel.xml" target="_blank" rel="noopener noreferrer">
                                ${github.outerHTML}
                            </a>`;
                        tr.append(td);
                    }
                    document.getElementById('table').appendChild(tr);
                });
            }
        </script>
    </div>
</div>
</body>

<script type="text/javascript">
    render();
</script>

</html>
